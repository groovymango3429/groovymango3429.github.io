<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clemson Class Scheduler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #fff5f0 0%, #f3e8ff 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        h1 { color: #f56600; font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { color: #666; font-size: 1rem; }
        .term-selector { text-align: right; }
        .term-selector label {
            display: block; font-size: 0.875rem; font-weight: 500; color: #4b5563; margin-bottom: 0.25rem;
        }
        .section { margin-bottom: 2rem; }
        .section-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 1rem; gap: 1rem;
        }
        h3 { font-size: 1.25rem; color: #1f2937; margin-bottom: 0.5rem; }
        .helper-text { font-size: 0.875rem; color: #6b7280; }
        label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem; }
        .input-group { display: flex; gap: 0.5rem; }
        input[type="text"], select {
            flex: 1; padding: 0.75rem 1rem; border: 1px solid #d1d5db;
            border-radius: 8px; font-size: 1rem; transition: all 0.2s;
        }
        input[type="text"]:focus, select:focus {
            outline: none; border-color: #f56600; box-shadow: 0 0 0 3px rgba(245, 102, 0, 0.1);
        }
        .btn-primary {
            background: #f56600; color: white; border: none;
            padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: background 0.2s;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .btn-primary:hover { background: #e05500; }
        .btn-secondary {
            background: #7c3aed; color: white; border: none;
            padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.875rem;
            font-weight: 600; cursor: pointer; transition: background 0.2s;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .btn-secondary:hover { background: #6d28d9; }
        .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-generate {
            width: 100%; background: linear-gradient(135deg, #f56600 0%, #7c3aed 100%);
            color: white; border: none; padding: 1rem; border-radius: 8px;
            font-size: 1.125rem; font-weight: 700; cursor: pointer;
            transition: transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.75rem;
        }
        .btn-generate:hover:not(:disabled) { transform: translateY(-2px); }
        .btn-generate:disabled { opacity: 0.5; cursor: not-allowed; }
        .course-tags { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .course-tag {
            background: #fed7aa; color: #9a3412; padding: 0.5rem 1rem;
            border-radius: 9999px; display: flex; align-items: center; gap: 0.5rem; font-weight: 500;
        }
        .course-tag button {
            background: none; border: none; color: #9a3412; cursor: pointer; padding: 0.25rem;
            border-radius: 9999px; transition: background 0.2s;
        }
        .course-tag button:hover { background: #fdba74; }
        .linked-group {
            background: #faf5ff; border: 2px solid #e9d5ff; border-radius: 8px;
            padding: 1rem; margin-bottom: 1rem;
        }
        .linked-group-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;
        }
        .linked-group-title {
            display: flex; align-items: center; gap: 0.5rem; color: #7c3aed; font-weight: 500;
        }
        .linked-group-remove {
            background: none; border: none; color: #dc2626; cursor: pointer; padding: 0.25rem;
            border-radius: 9999px; transition: background 0.2s;
        }
        .linked-group-remove:hover { background: #fee2e2; }
        .linked-courses { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem; }
        .linked-course-tag {
            background: white; color: #7c3aed; padding: 0.25rem 0.75rem; border-radius: 9999px;
            display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;
        }
        .linked-course-tag button {
            background: none; border: none; color: #7c3aed; cursor: pointer; padding: 0.125rem; transition: background 0.2s;
        }
        .linked-course-tag button:hover { background: #f3e8ff; }
        .schedule-types {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem;
        }
        .schedule-type {
            background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 1rem;
            cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .schedule-type:hover { border-color: #d1d5db; }
        .schedule-type.active { border-color: #f56600; background: #fff7ed; }
        .schedule-type .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .schedule-type .label { font-weight: 600; color: #1f2937; margin-bottom: 0.25rem; }
        .schedule-type .desc { font-size: 0.75rem; color: #6b7280; }
        .schedule-card {
            background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 1.5rem; margin-bottom: 1.5rem;
        }
        .schedule-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
        }
        .schedule-info { display: flex; align-items: center; gap: 1rem; }
        .score-badge {
            padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 700;
        }
        .score-high { background: #d1fae5; color: #065f46; }
        .score-medium { background: #fef3c7; color: #92400e; }
        .score-low { background: #fee2e2; color: #991b1b; }
        .btn-export {
            background: #2563eb; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px;
            font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: background 0.2s;
        }
        .btn-export:hover { background: #1d4ed8; }
        .class-section {
            border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;
            transition: box-shadow 0.2s;
        }
        .class-section:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .class-header {
            display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;
        }
        .class-title { font-size: 1.125rem; font-weight: 600; color: #1f2937; }
        .crn-badge {
            background: #f3f4f6; color: #6b7280; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;
        }
        .class-name { color: #6b7280; margin-bottom: 1rem; }
        .class-details {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; font-size: 0.875rem;
        }
        .detail-item { display: flex; align-items: center; gap: 0.5rem; color: #4b5563; }
        .detail-icon { width: 1rem; height: 1rem; }
        .seats-high { color: #059669; }
        .seats-medium { color: #d97706; }
        .seats-low { color: #dc2626; }
        .ready-card {
            background: #eff6ff; border: 2px solid #bfdbfe; border-radius: 12px; padding: 2rem; text-align: center;
        }
        .ready-card i { font-size: 3rem; color: #2563eb; margin-bottom: 1rem; }
        .ready-card h3 { color: #1e3a8a; margin-bottom: 0.5rem; }
        .ready-card p { color: #1e40af; }
        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
        }
        .spinner {
            width: 3rem; height: 3rem; border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-overlay p { color: white; font-size: 1.25rem; font-weight: 600; margin-top: 1rem; }
        .hidden { display: none !important; }
        #schedulesSection h2 { font-size: 1.75rem; color: #1f2937; margin-bottom: 1.5rem; }
        @media (max-width: 768px) {
            .main-card { padding: 1.5rem; }
            h1 { font-size: 1.5rem; }
            .header { flex-direction: column; }
            .term-selector { text-align: left; width: 100%; }
            .schedule-types { grid-template-columns: repeat(2, 1fr); }
            .input-group { flex-direction: column; }
            .section-header { flex-direction: column; align-items: flex-start; }
            .schedule-header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-card">
            <div class="header">
                <div>
                    <h1>Clemson Class Scheduler</h1>
                    <p class="subtitle">Find your perfect class schedule</p>
                </div>
                <div class="term-selector">
                    <label for="termCode">Term</label>
                    <select id="termCode">
                        <option value="202601">Spring 2026</option>
                        <option value="202508">Fall 2025</option>
                    </select>
                </div>
            </div>
            <div class="section">
                <label for="courseInput">Add Courses</label>
                <div class="input-group">
                    <input type="text" id="courseInput" placeholder="e.g., ENGR 1410, CPSC 1010, MATH 1060">
                    <button id="addCourseBtn" class="btn-primary">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
            </div>
            <div id="selectedCoursesSection" class="section hidden">
                <h3>Selected Courses</h3>
                <div id="selectedCoursesList" class="course-tags"></div>
            </div>
            <div class="section">
                <div class="section-header">
                    <div>
                        <h3>Linked Courses</h3>
                        <p class="helper-text">Courses that must have matching section numbers</p>
                    </div>
                    <button id="addLinkBtn" class="btn-secondary">
                        <i class="fas fa-link"></i> Add Link Group
                    </button>
                </div>
                <div id="linkedCoursesList"></div>
            </div>
            <div class="section">
                <label>Schedule Preference</label>
                <div class="schedule-types">
                    <button class="schedule-type active" data-type="balanced">
                        <div class="icon">⚖️</div>
                        <div class="label">Balanced</div>
                        <div class="desc">Even distribution throughout day</div>
                    </button>
                    <button class="schedule-type" data-type="early">
                        <div class="icon">🌅</div>
                        <div class="label">Early Bird</div>
                        <div class="desc">Classes end by early afternoon</div>
                    </button>
                    <button class="schedule-type" data-type="late">
                        <div class="icon">🌙</div>
                        <div class="label">Night Owl</div>
                        <div class="desc">Classes start later in the day</div>
                    </button>
                    <button class="schedule-type" data-type="compact">
                        <div class="icon">⚡</div>
                        <div class="label">Compact</div>
                        <div class="desc">Minimize gaps between classes</div>
                    </button>
                    <button class="schedule-type" data-type="mwf">
                        <div class="icon">📅</div>
                        <div class="label">MWF Focus</div>
                        <div class="desc">Prefer Monday/Wednesday/Friday</div>
                    </button>
                    <button class="schedule-type" data-type="tr">
                        <div class="icon">📆</div>
                        <div class="label">T/R Focus</div>
                        <div class="desc">Prefer Tuesday/Thursday</div>
                    </button>
                </div>
            </div>
            <button id="generateBtn" class="btn-generate" disabled>
                <i class="fas fa-calendar-alt"></i> Generate Schedules
            </button>
        </div>
        <div id="schedulesSection" class="hidden">
            <h2>Generated Schedules</h2>
            <div id="schedulesList"></div>
        </div>
        <div id="readySection" class="ready-card hidden">
            <i class="fas fa-info-circle"></i>
            <h3>Ready to Generate</h3>
            <p>Click "Generate Schedules" to find your optimal class schedule!</p>
        </div>
    </div>
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Generating Schedules...</p>
    </div>
    <script>
    let selectedCourses = [];
    let linkedCourses = [];
    let scheduleType = 'balanced';
    let generatedSchedules = [];
    let allCoursesData = [];
    const courseInput = document.getElementById('courseInput');
    const addCourseBtn = document.getElementById('addCourseBtn');
    const selectedCoursesSection = document.getElementById('selectedCoursesSection');
    const selectedCoursesList = document.getElementById('selectedCoursesList');
    const addLinkBtn = document.getElementById('addLinkBtn');
    const linkedCoursesList = document.getElementById('linkedCoursesList');
    const scheduleTypes = document.querySelectorAll('.schedule-type');
    const generateBtn = document.getElementById('generateBtn');
    const schedulesSection = document.getElementById('schedulesSection');
    const schedulesList = document.getElementById('schedulesList');
    const readySection = document.getElementById('readySection');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const termCodeSelect = document.getElementById('termCode');
    async function loadCoursesData() {
        try {
            // Use the static file in your repo for reliability
            const response = await fetch('course_schedule_2026.json');
            if (!response.ok) throw new Error('Failed to fetch courses');
            const data = await response.json();
            allCoursesData = Array.isArray(data) ? data : (data.data || []);
        } catch (error) {
            console.error('Error loading courses:', error);
            alert('Failed to load course data. Please ensure course_schedule_2026.json is in the same folder as index.html.');
            allCoursesData = [];
        }
        updateGenerateButton();
    }
    loadCoursesData();
    termCodeSelect.addEventListener('change', loadCoursesData);
    addCourseBtn.addEventListener('click', () => addCourse());
    courseInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCourse(); });
    addLinkBtn.addEventListener('click', addLinkedGroup);
    scheduleTypes.forEach(btn => {
        btn.addEventListener('click', () => {
            scheduleTypes.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            scheduleType = btn.dataset.type;
        });
    });
    generateBtn.addEventListener('click', generateSchedules);
    function validateCourse(courseCode) {
        const parts = courseCode.trim().split(/\s+/);
        if (parts.length !== 2) return null;
        const subject = parts[0].toUpperCase();
        const courseNumber = parts[1];
        const matches = allCoursesData.filter(course => course.subject === subject && course.courseNumber === courseNumber);
        return matches.length > 0 ? { subject, courseNumber, matches } : null;
    }
    function addCourse() {
        const courseCode = courseInput.value.trim().toUpperCase();
        if (!courseCode) return;
        const validation = validateCourse(courseCode);
        if (!validation) {
            alert(`Course "${courseCode}" not found in the ${termCodeSelect.options[termCodeSelect.selectedIndex].text} catalog. Please check the course code and try again.`);
            return;
        }
        const formattedCode = `${validation.subject} ${validation.courseNumber}`;
        if (!selectedCourses.includes(formattedCode)) {
            selectedCourses.push(formattedCode);
            courseInput.value = '';
            renderSelectedCourses();
            updateGenerateButton();
        } else {
            alert(`Course "${formattedCode}" is already added.`);
        }
    }
    function removeCourse(course) {
        selectedCourses = selectedCourses.filter(c => c !== course);
        linkedCourses = linkedCourses.filter(link => !link.courses.includes(course));
        renderSelectedCourses();
        renderLinkedCourses();
        updateGenerateButton();
    }
    function renderSelectedCourses() {
        if (selectedCourses.length === 0) {
            selectedCoursesSection.classList.add('hidden');
            return;
        }
        selectedCoursesSection.classList.remove('hidden');
        selectedCoursesList.innerHTML = selectedCourses.map(course => `
            <div class="course-tag">
                <span>${course}</span>
                <button onclick="removeCourse('${course}')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `).join('');
    }
    function addLinkedGroup() {
        if (selectedCourses.length < 2) {
            alert('Please add at least 2 courses before creating a linked group.');
            return;
        }
        linkedCourses.push({ id: Date.now(), courses: [] });
        renderLinkedCourses();
    }
    function removeLinkedGroup(id) {
        linkedCourses = linkedCourses.filter(link => link.id !== id);
        renderLinkedCourses();
    }
    function addCourseToLink(linkId, course) {
        const link = linkedCourses.find(l => l.id === linkId);
        if (link && !link.courses.includes(course)) {
            link.courses.push(course);
            renderLinkedCourses();
        }
    }
    function removeCourseFromLink(linkId, course) {
        const link = linkedCourses.find(l => l.id === linkId);
        if (link) {
            link.courses = link.courses.filter(c => c !== course);
            renderLinkedCourses();
        }
    }
    function renderLinkedCourses() {
        if (linkedCourses.length === 0) {
            linkedCoursesList.innerHTML = '';
            return;
        }
        linkedCoursesList.innerHTML = linkedCourses.map(link => {
            const availableCourses = selectedCourses.filter(c => !link.courses.includes(c));
            return `
                <div class="linked-group">
                    <div class="linked-group-header">
                        <div class="linked-group-title">
                            <i class="fas fa-link"></i>
                            <span>Must have same section number</span>
                        </div>
                        <button class="linked-group-remove" onclick="removeLinkedGroup(${link.id})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="linked-courses">
                        ${link.courses.map(course => `
                            <div class="linked-course-tag">
                                <span>${course}</span>
                                <button onclick="removeCourseFromLink(${link.id}, '${course}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    <select onchange="handleLinkSelect(${link.id}, this.value); this.value='';">
                        <option value="">+ Add course to this link group</option>
                        ${availableCourses.map(course => `
                            <option value="${course}">${course}</option>
                        `).join('')}
                    </select>
                </div>
            `;
        }).join('');
    }
    function handleLinkSelect(linkId, course) {
        if (course) {
            addCourseToLink(linkId, course);
        }
    }
    function updateGenerateButton() {
        generateBtn.disabled = selectedCourses.length === 0 || allCoursesData.length === 0;
    }
    function parseTime(timeStr) {
        if (!timeStr) return 0;
        const hour = parseInt(timeStr.substring(0, 2));
        const min = parseInt(timeStr.substring(2, 4));
        return hour * 60 + min;
    }
    function formatTime(timeStr) {
        if (!timeStr) return '';
        const hour = parseInt(timeStr.substring(0, 2));
        const min = timeStr.substring(2, 4);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
        return `${displayHour}:${min} ${ampm}`;
    }
    function getDaysString(meeting) {
        if (!meeting) return '';
        const days = [];
        if (meeting.monday) days.push('M');
        if (meeting.tuesday) days.push('T');
        if (meeting.wednesday) days.push('W');
        if (meeting.thursday) days.push('R');
        if (meeting.friday) days.push('F');
        return days.join('');
    }
    function scoreSchedule(sections) {
        let score = 100;
        const meetings = sections.map(s => s.meetingsFaculty && s.meetingsFaculty[0]?.meetingTime).filter(Boolean);
        if (meetings.length === 0) return 50;
        const times = meetings.map(m => parseTime(m.beginTime)).filter(t => t > 0);
        const endTimes = meetings.map(m => parseTime(m.endTime)).filter(t => t > 0);
        if (times.length === 0) return 50;
        const earliestStart = Math.min(...times);
        const latestEnd = Math.max(...endTimes);
        const totalSpan = latestEnd - earliestStart;
        if (scheduleType === 'early') {
            if (latestEnd > 840) score -= 20;
            if (earliestStart > 540) score -= 10;
        } else if (scheduleType === 'late') {
            if (earliestStart < 600) score -= 20;
            if (latestEnd < 900) score -= 10;
        } else if (scheduleType === 'compact') {
            const gapPenalty = (totalSpan - 300) / 30;
            score -= Math.max(0, gapPenalty * 5);
        } else if (scheduleType === 'mwf') {
            const mwfCount = meetings.filter(m => m.monday || m.wednesday || m.friday).length;
            score += (mwfCount / meetings.length) * 20;
        } else if (scheduleType === 'tr') {
            const trCount = meetings.filter(m => m.tuesday || m.thursday).length;
            score += (trCount / meetings.length) * 20;
        }
        for (let i = 0; i < meetings.length; i++) {
            for (let j = i + 1; j < meetings.length; j++) {
                const m1 = meetings[i];
                const m2 = meetings[j];
                const sharedDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].some(day => m1[day] && m2[day]);
                if (sharedDays) {
                    const start1 = parseTime(m1.beginTime);
                    const end1 = parseTime(m1.endTime);
                    const start2 = parseTime(m2.beginTime);
                    const end2 = parseTime(m2.endTime);
                    if ((start1 < end2 && end1 > start2) || (start2 < end1 && end2 > start1)) {
                        score -= 100;
                    }
                }
            }
        }
        const hasSeats = sections.every(s => s.seatsAvailable > 0);
        if (!hasSeats) score -= 30;
        return Math.max(0, Math.min(100, score));
    }
    async function generateSchedules() {
        loadingOverlay.classList.remove('hidden');
        try {
            const courseSections = {};
            for (const courseCode of selectedCourses) {
                const parts = courseCode.split(' ');
                const subject = parts[0];
                const courseNumber = parts[1];
                const sections = allCoursesData.filter(course =>
                    course.subject === subject &&
                    course.courseNumber === courseNumber &&
                    course.seatsAvailable > 0
                );
                if (sections.length === 0) {
                    alert(`No available sections found for ${courseCode}`);
                    loadingOverlay.classList.add('hidden');
                    return;
                }
                courseSections[courseCode] = sections;
            }
            const allSchedules = generateCombinations(courseSections);
            if (allSchedules.length === 0) {
                alert('No valid schedules found. Try adjusting your course selections or preferences.');
                loadingOverlay.classList.add('hidden');
                return;
            }
            generatedSchedules = allSchedules.map((sections, idx) => ({
                id: idx + 1,
                sections,
                score: scoreSchedule(sections)
            })).sort((a, b) => b.score - a.score);
            generatedSchedules = generatedSchedules.slice(0, 10);
            loadingOverlay.classList.add('hidden');
            renderSchedules();
        } catch (error) {
            console.error('Error generating schedules:', error);
            alert('An error occurred while generating schedules. Please try again.');
            loadingOverlay.classList.add('hidden');
        }
    }
    function generateCombinations(courseSections) {
        const courseKeys = Object.keys(courseSections);
        const combinations = [];
        function backtrack(index, currentSchedule) {
            if (index === courseKeys.length) {
                if (isValidLinkedSchedule(currentSchedule)) combinations.push([...currentSchedule]);
                return;
            }
            const courseKey = courseKeys[index];
            const sections = courseSections[courseKey];
            for (const section of sections) {
                if (!hasTimeConflict(currentSchedule, section)) {
                    currentSchedule.push(section);
                    backtrack(index + 1, currentSchedule);
                    currentSchedule.pop();
                }
                if (combinations.length >= 1000) return;
            }
        }
        backtrack(0, []);
        return combinations;
    }
    function hasTimeConflict(schedule, newSection) {
        const newMeeting = newSection.meetingsFaculty && newSection.meetingsFaculty[0]?.meetingTime;
        if (!newMeeting || !newMeeting.beginTime || !newMeeting.endTime) return false;
        for (const section of schedule) {
            const meeting = section.meetingsFaculty && section.meetingsFaculty[0]?.meetingTime;
            if (!meeting || !meeting.beginTime || !meeting.endTime) continue;
            const sharedDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].some(day => meeting[day] && newMeeting[day]);
            if (sharedDays) {
                const start1 = parseTime(meeting.beginTime);
                const end1 = parseTime(meeting.endTime);
                const start2 = parseTime(newMeeting.beginTime);
                const end2 = parseTime(newMeeting.endTime);
                if ((start1 < end2 && end1 > start2) || (start2 < end1 && end2 > start1)) {
                    return true;
                }
            }
        }
        return false;
    }
    function isValidLinkedSchedule(schedule) {
        if (linkedCourses.length === 0) return true;
        for (const link of linkedCourses) {
            if (link.courses.length < 2) continue;
            const sectionNumbers = link.courses.map(courseCode => {
                const section = schedule.find(s => `${s.subject} ${s.courseNumber}` === courseCode);
                return section ? section.sequenceNumber : null;
            });
            if (sectionNumbers.some(num => num === null)) continue;
            if (new Set(sectionNumbers).size > 1) return false;
        }
        return true;
    }
    function renderSchedules() {
        if (generatedSchedules.length === 0) {
            schedulesSection.classList.add('hidden');
            readySection.classList.remove('hidden');
            return;
        }
        readySection.classList.add('hidden');
        schedulesSection.classList.remove('hidden');
        schedulesList.innerHTML = generatedSchedules.map(schedule => {
            const scoreClass = schedule.score >= 80 ? 'score-high' :
                              schedule.score >= 60 ? 'score-medium' : 'score-low';
            return `
                <div class="schedule-card">
                    <div class="schedule-header">
                        <div class="schedule-info">
                            <div class="score-badge ${scoreClass}">Score: ${Math.round(schedule.score)}%</div>
                            <span style="color: #6b7280;">Schedule Option ${schedule.id}</span>
                        </div>
                        <button class="btn-export" onclick="exportSchedule(${schedule.id})">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                    <div class="sections-list">
                        ${schedule.sections.map(section => {
                            const meeting = section.meetingsFaculty && section.meetingsFaculty[0]?.meetingTime;
                            const faculty = section.faculty && section.faculty[0];
                            const seatsClass = section.seatsAvailable > 10 ? 'seats-high' :
                                               section.seatsAvailable > 5 ? 'seats-medium' : 'seats-low';
                            return `
                                <div class="class-section">
                                    <div class="class-header">
                                        <span class="class-title">${section.subject} ${section.courseNumber}-${section.sequenceNumber}</span>
                                        <span class="crn-badge">CRN: ${section.courseReferenceNumber}</span>
                                    </div>
                                    <div class="class-name">${section.courseTitle}</div>
                                    <div class="class-details">
                                        ${meeting ? `
                                            <div class="detail-item">
                                                <i class="fas fa-clock detail-icon"></i>
                                                <span>${getDaysString(meeting)} ${formatTime(meeting.beginTime)} - ${formatTime(meeting.endTime)}</span>
                                            </div>
                                            <div class="detail-item">
                                                <i class="fas fa-map-marker-alt detail-icon"></i>
                                                <span>${meeting.building} ${meeting.room}</span>
                                            </div>
                                        ` : '<div class="detail-item">Time: TBA</div>'}
                                        ${faculty ? `
                                            <div class="detail-item">
                                                <i class="fas fa-user detail-icon"></i>
                                                <span>${faculty.displayName}</span>
                                            </div>
                                        ` : ''}
                                        <div class="detail-item ${seatsClass}">
                                            <i class="fas fa-users detail-icon"></i>
                                            <span>${section.seatsAvailable} seats available</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
    function exportSchedule(scheduleId) {
        const schedule = generatedSchedules.find(s => s.id === scheduleId);
        if (!schedule) return;
        const text = `Schedule ${scheduleId} - Score: ${Math.round(schedule.score)}%\n\n` +
            schedule.sections.map(section => {
                const meeting = section.meetingsFaculty && section.meetingsFaculty[0]?.meetingTime;
                const faculty = section.faculty && section.faculty[0];
                return `${section.subject} ${section.courseNumber}-${section.sequenceNumber} - ${section.courseTitle}\n` +
                    `CRN: ${section.courseReferenceNumber}\n` +
                    (meeting ? `Time: ${getDaysString(meeting)} ${formatTime(meeting.beginTime)} - ${formatTime(meeting.endTime)}\n` +
                    `Location: ${meeting.building} ${meeting.room}\n` : 'Time: TBA\n') +
                    (faculty ? `Instructor: ${faculty.displayName}\n` : '') +
                    `Seats Available: ${section.seatsAvailable}\n`;
            }).join('\n');
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `schedule-${scheduleId}.txt`;
        a.click();
        URL.revokeObjectURL(url);
    }
    window.removeCourse = removeCourse;
    window.removeLinkedGroup = removeLinkedGroup;
    window.removeCourseFromLink = removeCourseFromLink;
    window.handleLinkSelect = handleLinkSelect;
    </script>
</body>
</html>